From 5e23bc376d4be9d8d3bb57791cf437de7dba0b12 Mon Sep 17 00:00:00 2001
From: Jian Li <pyguni@gmail.com>
Date: Sat, 27 Oct 2018 20:32:24 +0900
Subject: [PATCH] Fix: resolve nicira extension serialization issue

Change-Id: I65e71abb957f12f34c168fa102e9d9d512bcf907
---
 .../java/org/onosproject/driver/extensions/NiciraCt.java   | 7 ++++++-
 .../onosproject/driver/extensions/NiciraMatchCtMark.java   | 5 ++++-
 .../onosproject/driver/extensions/NiciraMatchCtState.java  | 5 ++++-
 3 files changed, 14 insertions(+), 3 deletions(-)

diff --git a/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraCt.java b/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraCt.java
index 1828a658fe..73f37c875e 100644
--- a/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraCt.java
+++ b/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraCt.java
@@ -24,6 +24,7 @@ import org.onosproject.net.flow.instructions.ExtensionTreatment;
 import org.onosproject.net.flow.instructions.ExtensionTreatmentType;
 
 import java.util.ArrayList;
+import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 import java.util.Objects;
@@ -39,7 +40,11 @@ public class NiciraCt extends AbstractExtension implements ExtensionTreatment {
     private short recircTable;
     private int alg;
     private List<ExtensionTreatment> nestedActions;
-    private final KryoNamespace appKryo = new KryoNamespace.Builder().build();
+    private final KryoNamespace appKryo = new KryoNamespace.Builder()
+                                                .register(HashMap.class)
+                                                .register(ArrayList.class)
+                                                .register(ExtensionTreatment.class)
+                                                .build();
 
     /**
      * Creates a new nicicra ct instruction.
diff --git a/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtMark.java b/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtMark.java
index 9203555889..67d9733e7c 100644
--- a/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtMark.java
+++ b/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtMark.java
@@ -16,6 +16,7 @@
 
 package org.onosproject.driver.extensions;
 
+import java.util.HashMap;
 import java.util.Map;
 import java.util.Objects;
 
@@ -35,7 +36,9 @@ public class NiciraMatchCtMark extends AbstractExtension implements ExtensionSel
     private long ctMark;
     private long ctMarkMask;
 
-    private final KryoNamespace appKryo = new KryoNamespace.Builder().build();
+    private final KryoNamespace appKryo = new KryoNamespace.Builder()
+                                                    .register(HashMap.class)
+                                                    .build();
 
     /**
      * Creates a new conntrack mark selector.
diff --git a/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtState.java b/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtState.java
index eb4c6daf4b..f2fb423eec 100644
--- a/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtState.java
+++ b/drivers/default/src/main/java/org/onosproject/driver/extensions/NiciraMatchCtState.java
@@ -16,6 +16,7 @@
 
 package org.onosproject.driver.extensions;
 
+import java.util.HashMap;
 import java.util.Map;
 import java.util.Objects;
 
@@ -34,7 +35,9 @@ public class NiciraMatchCtState extends AbstractExtension implements ExtensionSe
     private long ctState;
     private long ctStateMask;
 
-    private final KryoNamespace appKryo = new KryoNamespace.Builder().build();
+    private final KryoNamespace appKryo = new KryoNamespace.Builder()
+                                                .register(HashMap.class)
+                                                .build();
 
     /**
      * Creates a new conntrack state selector.
-- 
2.17.1 (Apple Git-112)

